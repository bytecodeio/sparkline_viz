!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.sparkline=t():e.sparkline=t()}(window,(function(){return d=[function(module,exports){eval('module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e,r){var n=r(2),o=r(3),i=r(4);t.exports=function(t){return n(t)||o(t)||i()}},function(t,e,r){"use strict";r.r(e),r.d(e,"sparkline",function(){return c});var n=r(0),o=r.n(n);function i(t,e,r,n){return parseFloat((e-n*e/t+r).toFixed(2))}function a(t){return t.value}function u(t,e){var r=document.createElementNS("http://www.w3.org/2000/svg",t);for(var n in e)r.setAttribute(n,e[n]);return r}function c(t,e,r){var n;if(n=t,o()(n.querySelectorAll("*")).forEach(function(t){return n.removeChild(t)}),!(e.length<=1)){r=r||{},"number"==typeof e[0]&&(e=e.map(function(t){return{value:t}}));var c=r.onmousemove,l=r.onmouseout,s="interactive"in r?r.interactive:!!c,f=r.spotRadius||2,p=2*f,d=r.cursorWidth||2,v=parseFloat(t.attributes["stroke-width"].value),b=r.fetch||a,h=e.map(function(t){return b(t)}),y=parseFloat(t.attributes.width.value)-2*p,x=parseFloat(t.attributes.height.value),m=x-2*v-p,g=Math.max.apply(Math,o()(h)),A=-1e3,w=h.length-1,j=y/w,O=[],k=i(g,m,v+f,h[0]),S="M".concat(p," ").concat(k);h.forEach(function(t,r){var n=r*j+p,o=i(g,m,v+f,t);O.push(Object.assign({},e[r],{index:r,x:n,y:o})),S+=" L ".concat(n," ").concat(o)});var M=u("path",{class:"sparkline--line",d:S,fill:"none"}),C=u("path",{class:"sparkline--fill",d:"".concat(S," V ").concat(x," L ").concat(p," ").concat(x," Z"),stroke:"none"});if(t.appendChild(C),t.appendChild(M),s){var E=u("line",{class:"sparkline--cursor",x1:A,x2:A,y1:0,y2:x,"stroke-width":d}),_=u("circle",{class:"sparkline--spot",cx:A,cy:A,r:f});t.appendChild(E),t.appendChild(_);var F=u("rect",{width:t.attributes.width.value,height:t.attributes.height.value,style:"fill: transparent; stroke: transparent",class:"sparkline--interaction-layer"});t.appendChild(F),F.addEventListener("mouseout",function(t){E.setAttribute("x1",A),E.setAttribute("x2",A),_.setAttribute("cx",A),l&&l(t)}),F.addEventListener("mousemove",function(t){var e=t.offsetX,r=O.find(function(t){return t.x>=e});r||(r=O[w]);var n,o=O[O.indexOf(r)-1],i=(n=o?o.x+(r.x-o.x)/2<=e?r:o:r).x,a=n.y;_.setAttribute("cx",i),_.setAttribute("cy",a),E.setAttribute("x1",i),E.setAttribute("x2",i),c&&c(t,n)})}}}e.default=c},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}}]);\n//# sourceMappingURL=sparkline.commonjs2.js.map\n\n//# sourceURL=webpack://%5Bname%5D/./node_modules/@fnando/sparkline/dist/sparkline.commonjs2.js?')},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "viz", function() { return viz; });\n/* harmony import */ var _fnando_sparkline__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(0);\n/* harmony import */ var _fnando_sparkline__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_fnando_sparkline__WEBPACK_IMPORTED_MODULE_0__);\n\n\nfunction findClosest(target, tagName) {\n   \n  if (target.tagName === tagName) {\n      return target;\n    }\n  \n    while ((target = target.parentNode)) {\n      if (target.tagName === tagName) {\n        return target;\n      }\n    }\n  \n    return target;\n  }\n\nvar sparkline_options = {\n    onmousemove(event, datapoint) {\n      var svg = findClosest(event.target, "svg");\n      \n      var tooltip = svg.nextElementSibling;\n      var date = (new Date(datapoint.date)).toUTCString().replace(/^.*?, (.*?) \\d{2}:\\d{2}:\\d{2}.*?$/, "$1");\n  \n        \n      tooltip.hidden = false;\n      tooltip.textContent = `${date}: ${datapoint.html}`;\n      tooltip.style.top = `${event.offsetY + 35}px`;\n      tooltip.style.left = `${event.offsetX - 20}px`;\n    },\n  \n    onmouseout() {\n      var svg = findClosest(event.target, "svg");\n      var tooltip = svg.nextElementSibling;\n      tooltip.hidden = true;\n    }\n  };\n  \n\nconst viz = looker.plugins.visualizations.add({\n    options: {\n          stroke: {\n          section: "Sparkline",\n          type: "array",\n          label: "Stroke color",\n          display: "color",\n          default: ["#353b49"]\n        },\n        strokeWidth: {\n            label: "Stroke width",\n            section: "Sparkline",\n            type: "number",\n            default: "3"  \n        },\n        fill: {\n            section: "Sparkline",\n            type: "array",\n            label: "Fill color",\n            display: "color"\n        },\n        top_label: {\n          section: "Header",\n          type: "string",\n          label: "Label (for top)",\n          placeholder: "My Great Chart"\n        }\n    },\n\tcreate: function(element, config){\n\t\telement.innerHTML = `<svg class="sparkline" width="${element.offsetWidth}" height="${element.offsetHeight - 37}" stroke-width="3"></svg>`;\n    },\n\tupdateAsync: function(data, element, config, queryResponse, details, doneRendering){\n        \n        let values = queryResponse.fields.measure_like.map((field) => {\n            let key =    field.label\n            let value =  field.name\n            return {[key]: value}\n        })\n        let firstDimension = queryResponse.fields.dimensions[0].name;\n        let options = this.options;\n        options["sparklineData"] =\n        {\n            section: "Sparkline",\n            type: "string",\n            label: "Measure for Sparkline",\n            display: "select",\n            values: values\n        }\n        options["headerData"] =\n        {\n            section: "Header",\n            type: "string",\n            label: "Measure for Header",\n            display: "select",\n            values: values,\n        }\n        if (config.sparklineData == null) {\n            this.trigger(\'registerOptions\', options) // register options with parent page to update visConfig\n        }\n        \n    \n        // Grab the first cell of the data\n        var firstRow = data[0];\n        var firstCell = firstRow[config.headerData];\n        var header = LookerCharts.Utils.htmlForCell(firstCell);\n        \n        var dataArray = [];\n        for(var row of data) {\n              var measureCell = row[config.sparklineData];\n              var dateCell = row[firstDimension];\n                dataArray.push({\n                  "name": config.top_label,\n                  "value": parseFloat(LookerCharts.Utils.textForCell(measureCell).replace(/[^0-9.]/g,\'\')),\n                  "date": LookerCharts.Utils.textForCell(dateCell),\n                  "html": LookerCharts.Utils.textForCell(measureCell)\n              });\n         }\n\n        //  Montserrat:\n        //  https://fonts.gstatic.com/s/montserrat/v14/JTUSjIg1_i6t8kCHKm459Wlhyw.woff2);}\'+\n         \n        var styleEl = document.createElement(\'style\');\n        styleEl.setAttribute(\'type\',"text/css")\n        styleEl.innerHTML = \'@font-face \'+\n          \'{font-family: Open Sans;\'+\n            \'src: url( https://fonts.gstatic.com/s/opensans/v17/mem8YaGs126MiZpBA-UFVZ0b.woff2 );}\'+\n          \'div {font-family: Open Sans;};\'\n\n\n         document.head.appendChild(styleEl);\n         element.innerHTML = `\n         \n         <div class="headerdiv" style="height: 52px; font-style: normal; font-weight: 300; font-size: 16px;">\n         ${config.top_label}\n         <div style="font-size: 24px; font-weight: bolder;">${header}</div></div>\n         <svg class="sparkline" width="${element.offsetWidth}" height="${element.offsetHeight - 32}" stroke-width="${config.strokeWidth}"\n          stroke="${config.stroke}"  fill="${config.fill}"></svg>\n          <span class="tooltip" style="position: absolute; \n            background: rgba(0, 0, 0, .7);\n            color: #fff;\n            padding: 2px 5px;\n            font-size: 12px;\n            white-space: nowrap;\n            z-index: 9999;\n          }" hidden="true"></span>`;\n    \n       \n         _fnando_sparkline__WEBPACK_IMPORTED_MODULE_0___default()(document.querySelector(".sparkline"), dataArray, sparkline_options);\n\t\tdoneRendering()\n\t}\n});\n\n//# sourceURL=webpack://%5Bname%5D/./src/visualizations/sparkline.js?')}],e={},f.m=d,f.c=e,f.d=function(e,t,n){f.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},f.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.t=function(e,t){if(1&t&&(e=f(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(f.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)f.d(n,r,function(t){return e[t]}.bind(null,r));return n},f.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(t,"a",t),t},f.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},f.p="",f(f.s=1);function f(t){if(e[t])return e[t].exports;var n=e[t]={i:t,l:!1,exports:{}};return d[t].call(n.exports,n,n.exports,f),n.l=!0,n.exports}var d,e}));